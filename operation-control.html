<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ“ä½œæ§åˆ¶ - æ— äººæœºè‡ªåŠ©æ‰“å¡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#6366F1',
                        accent: '#EC4899',
                        dark: '#1E293B',
                        light: '#F8FAFC',
                        'gray-medium': '#64748B',
                        'gray-light': '#E2E8F0',
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .touch-friendly {
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
            .pulse-ring {
                animation: pulseRing 2s infinite;
            }
        }
        
        @keyframes pulseRing {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
    </style>
</head>
<body class="font-inter bg-light text-dark antialiased touch-action-manipulation">
    <div class="min-h-screen w-full">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <header class="sticky top-0 left-0 right-0 bg-white z-30 shadow-sm">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <button onclick="location.href='user-management.html'" class="text-dark touch-friendly">
                    <i class="fa fa-arrow-left text-lg"></i>
                </button>
                <h1 class="text-xl font-bold">æ“ä½œæ§åˆ¶</h1>
                <a href="tel:400-888-6666" class="text-primary touch-friendly">
                    <i class="fa fa-phone text-lg"></i>
                </a>
            </div>
        </header>

        <!-- å½“å‰çŠ¶æ€æ˜¾ç¤º -->
        <div class="px-4 py-6">
            <div id="status-section" class="bg-gradient-to-r from-primary to-primary/80 rounded-xl p-6 text-white text-center mb-6">
                <div id="status-icon" class="text-4xl mb-3">ğŸ“</div>
                <div id="status-title" class="text-xl font-bold mb-2">è¯·å‰å¾€æ‹æ‘„åœ°ç‚¹</div>
                <div id="status-desc" class="text-white/90 text-sm">è¯·æŒ‰ç…§å¯¼èˆªæŒ‡å¼•å‰å¾€æŒ‡å®šçš„æ‹æ‘„åœ°ç‚¹</div>
            </div>
        </div>

        <!-- ä½ç½®ç¡®è®¤éƒ¨åˆ† -->
        <div id="location-section" class="px-4 space-y-6">
            <div class="bg-white rounded-xl shadow-sm p-5">
                <h3 class="font-bold text-lg mb-4 flex items-center">
                    <i class="fa fa-map-marker text-primary mr-2"></i>
                    ä½ç½®ç¡®è®¤
                </h3>
                
                <!-- åœ°å›¾åŒºåŸŸ -->
                <div class="relative rounded-xl overflow-hidden h-48 bg-gray-100 mb-4">
                    <img src="https://picsum.photos/id/1019/800/600" alt="æ‹æ‘„åœ°ç‚¹åœ°å›¾" class="w-full h-full object-cover">
                    <!-- åœ°å›¾æ ‡è®° -->
                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                        <div class="w-6 h-6 bg-primary rounded-full flex items-center justify-center border-4 border-white shadow-lg">
                            <div class="w-3 h-3 bg-white rounded-full"></div>
                        </div>
                        <div class="w-20 h-20 bg-primary/20 rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pulse-ring"></div>
                    </div>
                </div>
                
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-gray-medium text-sm">å½“å‰ä½ç½®</span>
                        <span id="location-status" class="text-orange-500 text-sm font-medium">æœªç¡®è®¤</span>
                    </div>
                    <div id="target-location" class="font-medium text-primary mb-1">å±±é¡¶è§‚æ™¯å°æ‹æ‘„ç‚¹</div>
                    <div id="distance-info" class="text-gray-medium text-sm">è·ç¦»ç›®æ ‡åœ°ç‚¹çº¦ <span id="distance">50</span> ç±³</div>
                </div>
                
                <button id="confirm-location-btn" onclick="confirmLocation()" class="w-full bg-primary text-white py-3 rounded-lg font-medium hover:bg-primary/90 transition-colors touch-friendly">
                    ç¡®è®¤åˆ°è¾¾æ‹æ‘„åœ°ç‚¹
                </button>
            </div>
        </div>

        <!-- æ— äººæœºæ§åˆ¶éƒ¨åˆ† -->
        <div id="control-section" class="px-4 space-y-6 hidden">
            <div class="bg-white rounded-xl shadow-sm p-5">
                <h3 class="font-bold text-lg mb-4 flex items-center">
                    <i class="fa fa-paper-plane text-primary mr-2"></i>
                    æ— äººæœºäº¤äº’æ§åˆ¶
                </h3>
                
                <button id="summon-btn" onclick="summonDrone()" class="w-full bg-gradient-to-r from-primary to-primary/80 text-white py-4 rounded-lg font-medium hover:opacity-90 transition-opacity touch-friendly mb-4 text-lg">
                    ğŸš å¬å”¤æ— äººæœº
                </button>
                
                <div id="countdown-display" class="text-center text-6xl font-bold text-primary mb-6 hidden">30</div>
                
                <div id="camera-preview" class="w-full h-48 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl mb-4 hidden flex flex-col items-center justify-center border-3 border-dashed border-primary">
                    <div class="text-4xl mb-2">ğŸ“·</div>
                    <div class="text-sm text-gray-medium">æ— äººæœºæ‘„åƒå¤´é¢„è§ˆ</div>
                </div>
                
                <button id="confirm-identity-btn" onclick="confirmIdentity()" class="w-full bg-accent text-white py-3 rounded-lg font-medium hover:bg-accent/90 transition-colors touch-friendly mb-3 hidden">
                    âœ‹ ä¸¾æ‰‹ç¡®è®¤èº«ä»½
                </button>
                
                <button id="start-shooting-btn" onclick="startShooting()" class="w-full bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-colors touch-friendly hidden pulse-ring">
                    ğŸ¬ å¼€å§‹æ‹æ‘„
                </button>
            </div>

            <!-- æ— äººæœºçŠ¶æ€ -->
            <div class="bg-white rounded-xl shadow-sm p-5">
                <h3 class="font-bold text-lg mb-4 flex items-center">
                    <i class="fa fa-info-circle text-primary mr-2"></i>
                    æ— äººæœºçŠ¶æ€
                </h3>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-medium">å½“å‰çŠ¶æ€:</span>
                        <span class="font-medium text-green-500">å¾…å‘½</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-medium">ç”µæ± ç”µé‡:</span>
                        <span class="font-medium text-green-500">95%</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-medium">é£è¡Œé«˜åº¦:</span>
                        <span class="font-medium">0ç±³</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-medium">ä¿¡å·å¼ºåº¦:</span>
                        <span class="font-medium text-green-500">å¼º</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ‹æ‘„è¿›åº¦ -->
        <div id="shooting-progress" class="px-4 space-y-6 hidden">
            <div class="bg-white rounded-xl shadow-sm p-5">
                <div class="text-center mb-6">
                    <div class="text-2xl font-bold mb-2">æ­£åœ¨æ‹æ‘„ä¸­...</div>
                    <div class="w-full bg-gray-200 rounded-full h-3 mb-2">
                        <div id="progress-fill" class="bg-gradient-to-r from-primary to-accent h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <div id="progress-text" class="text-sm text-gray-medium">æ‹æ‘„è¿›åº¦: 0%</div>
                </div>
            </div>
        </div>

        <!-- è¯­éŸ³æç¤º -->
        <div id="voice-tips" class="fixed bottom-24 left-4 right-4 bg-amber-100 border border-amber-300 rounded-lg p-4 hidden">
            <div class="flex items-center">
                <div class="text-amber-600 text-xl mr-3">ğŸ”Š</div>
                <div id="voice-tip-text" class="text-amber-700 font-medium">è¯·ä¿æŒå¾®ç¬‘ï¼Œçœ‹å‘é•œå¤´</div>
            </div>
        </div>

        <!-- å®Œæˆé¡µé¢ -->
        <div id="completion-section" class="px-4 py-6 hidden">
            <div class="bg-white rounded-xl shadow-sm p-6 text-center">
                <div class="text-6xl mb-4">ğŸ‰</div>
                <div class="text-2xl font-bold mb-2">æ‹æ‘„å®Œæˆï¼</div>
                <div class="text-gray-medium mb-6 leading-relaxed">
                    æ‚¨çš„æ‹æ‘„å·²æˆåŠŸå®Œæˆï¼<br>
                    æˆ‘ä»¬çš„AIç³»ç»Ÿå°†åœ¨24å°æ—¶å†…å®Œæˆå‰ªè¾‘ï¼Œ<br>
                    è¯·ç•™æ„å¾®ä¿¡é€šçŸ¥æ¥æ”¶æˆç‰‡ã€‚
                </div>
                <button onclick="location.href='after-service.html'" class="bg-primary text-white px-8 py-3 rounded-lg font-medium hover:bg-primary/90 transition-colors touch-friendly">
                    å®šåˆ¶æˆç‰‡æ•ˆæœ â†’
                </button>
            </div>
        </div>

        <!-- æ‹æ‘„æŒ‡å— -->
        <div class="px-4 py-6">
            <div class="bg-white rounded-xl shadow-sm p-5">
                <h3 class="font-bold text-lg mb-4 flex items-center">
                    <i class="fa fa-lightbulb-o text-accent mr-2"></i>
                    æ‹æ‘„æŒ‡å—
                </h3>
                <ul class="space-y-3 text-sm">
                    <li class="flex items-start">
                        <i class="fa fa-check-circle text-green-500 mt-1 mr-3"></i>
                        <span>è¯·ç¡®ä¿æ‚¨å·²ç«™åœ¨æŒ‡å®šæ‹æ‘„åŒºåŸŸå†…</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fa fa-check-circle text-green-500 mt-1 mr-3"></i>
                        <span>æ— äººæœºåˆ°è¾¾åï¼Œè¯·ä¿æŒå¾®ç¬‘å¹¶åšå‡ºè‡ªç„¶å§¿åŠ¿</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fa fa-check-circle text-green-500 mt-1 mr-3"></i>
                        <span>æ‹æ‘„è¿‡ç¨‹ä¸­è¯·å¬ä»è¯­éŸ³æç¤ºï¼Œä¸è¦éšæ„ç§»åŠ¨</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fa fa-check-circle text-green-500 mt-1 mr-3"></i>
                        <span>å¦‚é‡ç´§æ€¥æƒ…å†µï¼Œè¯·è”ç³»å®¢æœï¼š400-888-6666</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- JavaScriptäº¤äº’ä»£ç  -->
    <script>
        let currentStep = 'location'; // location, control, shooting, completed
        let countdownTimer = null;
        let progressTimer = null;
        let currentProgress = 0;

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', function() {
            loadOrderInfo();
            simulateLocationTracking();
        });

        // åŠ è½½è®¢å•ä¿¡æ¯
        function loadOrderInfo() {
            const order = JSON.parse(localStorage.getItem('currentOrder') || '{}');
            if (order.location) {
                document.getElementById('target-location').textContent = order.location;
            }
        }

        // æ¨¡æ‹Ÿä½ç½®è·Ÿè¸ª
        function simulateLocationTracking() {
            let distance = 50;
            const interval = setInterval(() => {
                distance -= Math.random() * 8 + 2;
                if (distance <= 5) {
                    distance = 0;
                    document.getElementById('distance').textContent = '0';
                    document.getElementById('location-status').textContent = 'å·²åˆ°è¾¾';
                    document.getElementById('location-status').className = 'text-green-500 text-sm font-medium';
                    document.getElementById('confirm-location-btn').disabled = false;
                    document.getElementById('confirm-location-btn').textContent = 'å·²åˆ°è¾¾ - ç‚¹å‡»ç¡®è®¤';
                    document.getElementById('confirm-location-btn').classList.remove('bg-primary');
                    document.getElementById('confirm-location-btn').classList.add('bg-green-500');
                    clearInterval(interval);
                } else {
                    document.getElementById('distance').textContent = Math.round(distance);
                }
            }, 2000);
        }

        // ç¡®è®¤ä½ç½®
        function confirmLocation() {
            document.getElementById('location-status').textContent = 'å·²ç¡®è®¤';
            document.getElementById('location-status').className = 'text-green-500 text-sm font-medium';
            
            // æ›´æ–°çŠ¶æ€
            updateStatus('ğŸ¯', 'ä½ç½®ç¡®è®¤æˆåŠŸ', 'è¯·å¬å”¤æ— äººæœºå¼€å§‹æ‹æ‘„');
            
            // æ˜¾ç¤ºæ§åˆ¶é¢æ¿
            document.getElementById('location-section').classList.add('hidden');
            document.getElementById('control-section').classList.remove('hidden');
            
            currentStep = 'control';
        }

        // å¬å”¤æ— äººæœº
        function summonDrone() {
            updateStatus('ğŸš', 'æ— äººæœºæ­£åœ¨é£æ¥', 'è¯·ç¨ç­‰ï¼Œæ— äººæœºå°†åœ¨30ç§’å†…åˆ°è¾¾');
            
            document.getElementById('summon-btn').disabled = true;
            document.getElementById('summon-btn').innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i> æ— äººæœºé£è¡Œä¸­...';
            
            // å¼€å§‹å€’è®¡æ—¶
            startCountdown(30, () => {
                droneArrived();
            });
        }

        // å¼€å§‹å€’è®¡æ—¶
        function startCountdown(seconds, callback) {
            const countdownEl = document.getElementById('countdown-display');
            countdownEl.classList.remove('hidden');
            
            let remaining = seconds;
            countdownEl.textContent = remaining;
            
            countdownTimer = setInterval(() => {
                remaining--;
                countdownEl.textContent = remaining;
                
                if (remaining <= 0) {
                    clearInterval(countdownTimer);
                    countdownEl.classList.add('hidden');
                    callback();
                }
            }, 1000);
        }

        // æ— äººæœºåˆ°è¾¾
        function droneArrived() {
            updateStatus('ğŸµ', 'æ— äººæœºå·²åˆ°è¾¾', 'æ— äººæœºæ­£åœ¨ç›˜æ—‹å¹¶æ’­æ”¾BGMï¼Œè¯·ä¸¾æ‰‹ç¡®è®¤èº«ä»½');
            
            // æ˜¾ç¤ºæ‘„åƒå¤´é¢„è§ˆ
            document.getElementById('camera-preview').classList.remove('hidden');
            document.getElementById('confirm-identity-btn').classList.remove('hidden');
            
            // æ’­æ”¾BGMæç¤º
            showVoiceTip('ğŸµ è¯·é¢å‘æ— äººæœºï¼Œä¸¾æ‰‹ç¤ºæ„');
        }

        // ç¡®è®¤èº«ä»½
        function confirmIdentity() {
            updateStatus('ğŸ“¸', 'èº«ä»½è¯†åˆ«ä¸­', 'æ­£åœ¨è¿›è¡Œäººè„¸è¯†åˆ«ç¡®è®¤');
            
            document.getElementById('confirm-identity-btn').disabled = true;
            
            // æ¨¡æ‹Ÿè¯†åˆ«è¿‡ç¨‹
            setTimeout(() => {
                updateStatus('âœ…', 'èº«ä»½ç¡®è®¤æˆåŠŸ', 'è¯·å‡†å¤‡å¼€å§‹æ‹æ‘„');
                document.getElementById('start-shooting-btn').classList.remove('hidden');
                showVoiceTip('âœ… èº«ä»½ç¡®è®¤æˆåŠŸï¼Œç‚¹å‡»å¼€å§‹æ‹æ‘„');
            }, 3000);
        }

        // å¼€å§‹æ‹æ‘„
        function startShooting() {
            updateStatus('ğŸ¬', 'æ‹æ‘„è¿›è¡Œä¸­', 'è¯·é…åˆæ— äººæœºæŒ‡ç¤ºï¼Œä¿æŒæœ€ä½³çŠ¶æ€');
            
            document.getElementById('control-section').classList.add('hidden');
            document.getElementById('shooting-progress').classList.remove('hidden');
            
            currentStep = 'shooting';
            
            // å¼€å§‹æ‹æ‘„è¿›åº¦
            startShootingProgress();
        }

        // æ‹æ‘„è¿›åº¦æ§åˆ¶
        function startShootingProgress() {
            const voiceTips = [
                'è¯·ä¿æŒå¾®ç¬‘ï¼Œçœ‹å‘é•œå¤´',
                'è¯·ç¨å¾®å‘å·¦è½¬èº«',
                'å¾ˆå¥½ï¼Œä¿æŒè¿™ä¸ªå§¿åŠ¿',
                'è¯·ä¸¾èµ·å³æ‰‹æŒ¥æŒ¥æ‰‹',
                'å®Œç¾ï¼è¯·ä¿æŒè‡ªç„¶çŠ¶æ€',
                'æ‹æ‘„å³å°†å®Œæˆ...'
            ];
            
            let tipIndex = 0;
            currentProgress = 0;
            
            progressTimer = setInterval(() => {
                currentProgress += Math.random() * 12 + 3;
                
                if (currentProgress >= 100) {
                    currentProgress = 100;
                    clearInterval(progressTimer);
                    completeShooting();
                }
                
                // æ›´æ–°è¿›åº¦æ¡
                document.getElementById('progress-fill').style.width = currentProgress + '%';
                document.getElementById('progress-text').textContent = `æ‹æ‘„è¿›åº¦: ${Math.round(currentProgress)}%`;
                
                // æ˜¾ç¤ºè¯­éŸ³æç¤º
                if (tipIndex < voiceTips.length && currentProgress > (tipIndex + 1) * 16.67) {
                    showVoiceTip('ğŸ”Š ' + voiceTips[tipIndex]);
                    tipIndex++;
                }
            }, 2000);
        }

        // å®Œæˆæ‹æ‘„
        function completeShooting() {
            updateStatus('ğŸ‰', 'æ‹æ‘„å®Œæˆ', 'æ— äººæœºæ­£åœ¨è¿”èˆªï¼Œæˆç‰‡å°†åœ¨24å°æ—¶å†…åˆ¶ä½œå®Œæˆ');
            
            document.getElementById('shooting-progress').classList.add('hidden');
            document.getElementById('completion-section').classList.remove('hidden');
            
            showVoiceTip('ğŸ‰ æ‹æ‘„å®Œæˆï¼æ— äººæœºæ­£åœ¨è¿”èˆª');
            
            // æ¨¡æ‹Ÿæ— äººæœºè¿”èˆª
            setTimeout(() => {
                hideVoiceTip();
            }, 5000);
            
            currentStep = 'completed';
        }

        // æ˜¾ç¤ºè¯­éŸ³æç¤º
        function showVoiceTip(text) {
            document.getElementById('voice-tip-text').textContent = text;
            document.getElementById('voice-tips').classList.remove('hidden');
            
            // è‡ªåŠ¨éšè—æç¤º
            setTimeout(() => {
                hideVoiceTip();
            }, 4000);
        }

        // éšè—è¯­éŸ³æç¤º
        function hideVoiceTip() {
            document.getElementById('voice-tips').classList.add('hidden');
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(icon, title, desc) {
            document.getElementById('status-icon').textContent = icon;
            document.getElementById('status-title').textContent = title;
            document.getElementById('status-desc').textContent = desc;
        }

        // é¡µé¢ç¦»å¼€æ—¶æ¸…ç†å®šæ—¶å™¨
        window.addEventListener('beforeunload', function() {
            if (countdownTimer) clearInterval(countdownTimer);
            if (progressTimer) clearInterval(progressTimer);
        });
    </script>
</body>
</html>