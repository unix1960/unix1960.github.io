<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ“ä½œæ§åˆ¶ - æ— äººæœºè‡ªåŠ©æ‰“å¡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#07C160',
                        secondary: '#6366F1',
                        accent: '#FF6B35',
                        dark: '#1E293B',
                        light: '#F8FAFC',
                        'gray-medium': '#64748B',
                        'gray-light': '#E2E8F0',
                        'wx-green': '#07C160',
                        'wx-blue': '#576B95',
                    },
                    fontFamily: {
                        inter: ['Inter', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .touch-friendly {
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
            .safe-area-bottom {
                padding-bottom: constant(safe-area-inset-bottom);
                padding-bottom: env(safe-area-inset-bottom);
            }
            .miniprogram-scroll {
                -webkit-overflow-scrolling: touch;
            }
            .miniprogram-card {
                box-shadow: 0 2px 8px rgba(0,0,0,0.06);
                border-radius: 8px;
            }
            .wx-button {
                border-radius: 4px;
                font-size: 16px;
                line-height: 1.4;
            }
            .pulse-ring {
                animation: pulseRing 2s infinite;
            }
            .drone-animation {
                animation: droneHover 3s ease-in-out infinite;
            }
            .countdown-animation {
                animation: countdownPulse 1s ease-in-out infinite;
            }
        }
        
        @keyframes pulseRing {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(7, 193, 96, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 15px rgba(7, 193, 96, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(7, 193, 96, 0); }
        }

        @keyframes droneHover {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes countdownPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    </style>
</head>
<body class="font-inter bg-light text-dark antialiased touch-action-manipulation">
    <div class="min-h-screen w-full pb-20 safe-area-bottom">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <header class="sticky top-0 left-0 right-0 bg-white z-30 border-b border-gray-light">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <button onclick="location.href='user-management_v2.html'" class="text-dark touch-friendly p-2 -ml-2">
                    <i class="fa fa-arrow-left text-lg"></i>
                </button>
                <h1 class="text-lg font-medium">æ“ä½œæ§åˆ¶</h1>
                <a href="tel:400-888-6666" class="text-primary touch-friendly p-2 -mr-2">
                    <i class="fa fa-phone text-lg"></i>
                </a>
            </div>
        </header>

        <!-- å½“å‰çŠ¶æ€æ˜¾ç¤º -->
        <div class="px-4 py-4">
            <div id="status-section" class="bg-gradient-to-r from-primary to-primary/80 rounded-xl p-5 text-white text-center mb-4 miniprogram-card">
                <div id="status-icon" class="text-3xl mb-2">ğŸ“</div>
                <div id="status-title" class="text-lg font-bold mb-1">è¯·å‰å¾€æ‹æ‘„åœ°ç‚¹</div>
                <div id="status-desc" class="text-white/90 text-sm">è¯·æŒ‰ç…§å¯¼èˆªæŒ‡å¼•å‰å¾€æŒ‡å®šçš„æ‹æ‘„åœ°ç‚¹</div>
            </div>
        </div>

        <!-- ä½ç½®ç¡®è®¤éƒ¨åˆ† -->
        <div id="location-section" class="px-4 space-y-4 miniprogram-scroll">
            <div class="miniprogram-card bg-white p-4">
                <h3 class="font-medium text-base mb-3 flex items-center">
                    <i class="fa fa-map-marker text-primary mr-2"></i>
                    ä½ç½®ç¡®è®¤
                </h3>
                
                <!-- åœ°å›¾åŒºåŸŸ -->
                <div class="relative rounded-lg overflow-hidden h-40 bg-gray-100 mb-3">
                    <img src="https://picsum.photos/id/1019/800/600" alt="æ‹æ‘„åœ°ç‚¹åœ°å›¾" class="w-full h-full object-cover">
                    <!-- åœ°å›¾æ ‡è®° -->
                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                        <div class="w-5 h-5 bg-primary rounded-full flex items-center justify-center border-3 border-white shadow-lg">
                            <div class="w-2 h-2 bg-white rounded-full"></div>
                        </div>
                        <div class="w-16 h-16 bg-primary/20 rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pulse-ring"></div>
                    </div>
                </div>
                
                <div class="bg-gray-50 rounded-lg p-3 mb-3">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-gray-medium text-sm">å½“å‰ä½ç½®</span>
                        <span id="location-status" class="text-orange-500 text-sm font-medium">æœªç¡®è®¤</span>
                    </div>
                    <div id="target-location" class="font-medium text-primary mb-1 text-sm">å±±é¡¶è§‚æ™¯å°æ‹æ‘„ç‚¹</div>
                    <div id="distance-info" class="text-gray-medium text-xs">è·ç¦»ç›®æ ‡åœ°ç‚¹çº¦ <span id="distance">50</span> ç±³</div>
                </div>
                
                <button id="confirm-location-btn" onclick="confirmLocation()" class="w-full bg-primary text-white py-3 rounded-lg font-medium touch-friendly wx-button">
                    ç¡®è®¤åˆ°è¾¾æ‹æ‘„åœ°ç‚¹
                </button>
            </div>

            <!-- GPSå®šä½æç¤º -->
            <div class="miniprogram-card bg-amber-50 border border-amber-200 p-3">
                <div class="flex items-start space-x-2">
                    <i class="fa fa-info-circle text-amber-600 mt-0.5"></i>
                    <div class="text-amber-700 text-sm">
                        <div class="font-medium mb-1">æ™ºèƒ½AIè·¯çº¿å¼•å¯¼</div>
                        <div class="text-xs">ç³»ç»Ÿæ­£åœ¨ä¸ºæ‚¨è§„åˆ’æœ€ä½³è·¯çº¿ï¼Œè¯·æŒ‰ç…§åœ°å›¾æŒ‡å¼•å‰å¾€æ‹æ‘„åœ°ç‚¹</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ— äººæœºæ§åˆ¶éƒ¨åˆ† -->
        <div id="control-section" class="px-4 space-y-4 miniprogram-scroll hidden">
            <div class="miniprogram-card bg-white p-4">
                <h3 class="font-medium text-base mb-3 flex items-center">
                    <i class="fa fa-paper-plane text-primary mr-2"></i>
                    æ— äººæœºäº¤äº’æ§åˆ¶
                </h3>
                
                <button id="summon-btn" onclick="summonDrone()" class="w-full bg-gradient-to-r from-primary to-primary/80 text-white py-4 rounded-lg font-medium touch-friendly mb-3 text-base wx-button">
                    ğŸš å¬å”¤æ— äººæœº
                </button>
                
                <div id="countdown-display" class="text-center text-5xl font-bold text-primary mb-4 hidden countdown-animation">30</div>
                
                <div id="camera-preview" class="w-full h-36 bg-gradient-to-br from-gray-100 to-gray-200 rounded-lg mb-3 hidden flex flex-col items-center justify-center border-2 border-dashed border-primary">
                    <div class="text-3xl mb-1 drone-animation">ğŸ“·</div>
                    <div class="text-sm text-gray-medium">æ— äººæœºæ‘„åƒå¤´é¢„è§ˆ</div>
                </div>
                
                <button id="confirm-identity-btn" onclick="confirmIdentity()" class="w-full bg-accent text-white py-3 rounded-lg font-medium touch-friendly mb-3 hidden wx-button">
                    âœ‹ ä¸¾æ‰‹ç¡®è®¤èº«ä»½
                </button>
                
                <button id="start-shooting-btn" onclick="startShooting()" class="w-full bg-green-500 text-white py-3 rounded-lg font-medium touch-friendly hidden pulse-ring wx-button">
                    ğŸ¬ å¼€å§‹æ‹æ‘„
                </button>
            </div>

            <!-- æ— äººæœºçŠ¶æ€ -->
            <div class="miniprogram-card bg-white p-4">
                <h3 class="font-medium text-base mb-3 flex items-center">
                    <i class="fa fa-info-circle text-primary mr-2"></i>
                    æ— äººæœºçŠ¶æ€
                </h3>
                <div class="grid grid-cols-2 gap-3 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-medium">å½“å‰çŠ¶æ€:</span>
                        <span class="font-medium text-green-500">å¾…å‘½</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-medium">ç”µæ± ç”µé‡:</span>
                        <span class="font-medium text-green-500">95%</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-medium">é£è¡Œé«˜åº¦:</span>
                        <span class="font-medium">0ç±³</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-medium">ä¿¡å·å¼ºåº¦:</span>
                        <span class="font-medium text-green-500">å¼º</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ‹æ‘„è¿›åº¦ -->
        <div id="shooting-progress" class="px-4 space-y-4 miniprogram-scroll hidden">
            <div class="miniprogram-card bg-white p-4">
                <div class="text-center mb-4">
                    <div class="text-xl font-bold mb-2">æ­£åœ¨æ‹æ‘„ä¸­...</div>
                    <div class="w-full bg-gray-200 rounded-full h-2 mb-2">
                        <div id="progress-fill" class="bg-gradient-to-r from-primary to-accent h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <div id="progress-text" class="text-sm text-gray-medium">æ‹æ‘„è¿›åº¦: 0%</div>
                </div>
                
                <!-- å®æ—¶ç…§ç‰‡æ˜¾ç¤º -->
                <div class="bg-gray-50 rounded-lg p-3 text-center">
                    <div class="text-sm font-medium mb-2">å®æ—¶ç…§ç‰‡é¢„è§ˆ</div>
                    <div class="w-20 h-16 bg-gradient-to-br from-blue-100 to-blue-200 rounded mx-auto flex items-center justify-center">
                        <i class="fa fa-image text-blue-500 text-lg"></i>
                    </div>
                    <div class="text-xs text-gray-medium mt-1">å·²æ‹æ‘„ <span id="photo-count">3</span> å¼ </div>
                </div>
            </div>
        </div>

        <!-- è¯­éŸ³æç¤º -->
        <div id="voice-tips" class="fixed bottom-20 left-4 right-4 bg-amber-100 border border-amber-300 rounded-lg p-3 hidden safe-area-bottom z-40">
            <div class="flex items-center">
                <div class="text-amber-600 text-lg mr-2">ğŸ”Š</div>
                <div id="voice-tip-text" class="text-amber-700 font-medium text-sm">è¯·ä¿æŒå¾®ç¬‘ï¼Œçœ‹å‘é•œå¤´</div>
            </div>
        </div>

        <!-- å®Œæˆé¡µé¢ -->
        <div id="completion-section" class="px-4 py-4 hidden">
            <div class="miniprogram-card bg-white p-5 text-center">
                <div class="text-5xl mb-3">ğŸ‰</div>
                <div class="text-xl font-bold mb-2">æ‹æ‘„å®Œæˆï¼</div>
                <div class="text-gray-medium mb-4 leading-relaxed text-sm">
                    æ‚¨çš„æ‹æ‘„å·²æˆåŠŸå®Œæˆï¼<br>
                    æˆ‘ä»¬çš„AIç³»ç»Ÿå°†åœ¨24å°æ—¶å†…å®Œæˆå‰ªè¾‘ï¼Œ<br>
                    è¯·ç•™æ„å¾®ä¿¡é€šçŸ¥æ¥æ”¶æˆç‰‡ã€‚
                </div>
                <button onclick="location.href='after-service_v2.html'" class="bg-primary text-white px-6 py-3 rounded-lg font-medium touch-friendly wx-button">
                    å®šåˆ¶æˆç‰‡æ•ˆæœ â†’
                </button>
            </div>
        </div>

        <!-- æ‹æ‘„æŒ‡å— -->
        <div class="px-4 py-4">
            <div class="miniprogram-card bg-white p-4">
                <h3 class="font-medium text-base mb-3 flex items-center">
                    <i class="fa fa-lightbulb-o text-accent mr-2"></i>
                    æ‹æ‘„æŒ‡å—
                </h3>
                <ul class="space-y-2 text-sm">
                    <li class="flex items-start">
                        <i class="fa fa-check-circle text-green-500 mt-0.5 mr-2 text-xs"></i>
                        <span>è¯·ç¡®ä¿æ‚¨å·²ç«™åœ¨æŒ‡å®šæ‹æ‘„åŒºåŸŸå†…</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fa fa-check-circle text-green-500 mt-0.5 mr-2 text-xs"></i>
                        <span>æ— äººæœºåˆ°è¾¾åï¼Œè¯·ä¿æŒå¾®ç¬‘å¹¶åšå‡ºè‡ªç„¶å§¿åŠ¿</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fa fa-check-circle text-green-500 mt-0.5 mr-2 text-xs"></i>
                        <span>æ‹æ‘„è¿‡ç¨‹ä¸­è¯·å¬ä»è¯­éŸ³æç¤ºï¼Œä¸è¦éšæ„ç§»åŠ¨</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fa fa-check-circle text-green-500 mt-0.5 mr-2 text-xs"></i>
                        <span>å¦‚é‡ç´§æ€¥æƒ…å†µï¼Œè¯·è”ç³»å®¢æœï¼š400-888-6666</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- å¾®ä¿¡å°ç¨‹åºåº•éƒ¨å¯¼èˆªæ  -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-light z-50 safe-area-bottom">
        <div class="flex justify-around items-center h-16">
            <div class="tab-item flex flex-col items-center justify-center text-gray-medium touch-friendly" onclick="location.href='index_v2.html'">
                <i class="fa fa-home text-lg mb-1"></i>
                <span class="text-xs">é¦–é¡µ</span>
            </div>
            <div class="tab-item flex flex-col items-center justify-center text-gray-medium touch-friendly" onclick="location.href='sample-display_v2.html'">
                <i class="fa fa-picture-o text-lg mb-1"></i>
                <span class="text-xs">æ ·ç‰‡</span>
            </div>
            <div class="tab-item flex flex-col items-center justify-center text-gray-medium touch-friendly" onclick="location.href='user-selection_v2.html'">
                <i class="fa fa-camera text-lg mb-1"></i>
                <span class="text-xs">æ‹æ‘„</span>
            </div>
            <div class="tab-item flex flex-col items-center justify-center text-gray-medium touch-friendly no-scale" onclick="location.href='user-management_v2.html'">
                <i class="fa fa-user text-lg mb-1"></i>
                <span class="text-xs">è®¢å•</span>
            </div>
            <div class="tab-item flex flex-col items-center justify-center touch-friendly active">
                <div class="w-12 h-12 rounded-full bg-primary text-white flex items-center justify-center -mt-6 shadow-lg relative">
                    <i class="fa fa-cog text-lg"></i>
                </div>
                <span class="text-xs text-primary font-medium mt-1">æ§åˆ¶</span>
            </div>
        </div>
    </nav>

    <!-- JavaScriptäº¤äº’ä»£ç  -->
    <script>
        let currentStep = 'location'; // location, control, shooting, completed
        let countdownTimer = null;
        let progressTimer = null;
        let currentProgress = 0;

        // å°ç¨‹åºæ ·å¼åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // æ·»åŠ å°ç¨‹åºé£æ ¼çš„è§¦æ‘¸åé¦ˆ
            const touchElements = document.querySelectorAll('.touch-friendly');
            touchElements.forEach(element => {
                // è·³è¿‡æœ‰ no-scale ç±»çš„å…ƒç´ 
                if (element.classList.contains('no-scale')) {
                    element.addEventListener('touchstart', function() {
                        this.style.opacity = '0.7';
                    });
                    
                    element.addEventListener('touchend', function() {
                        this.style.opacity = '1';
                    });
                    
                    element.addEventListener('touchcancel', function() {
                        this.style.opacity = '1';
                    });
                } else {
                    element.addEventListener('touchstart', function() {
                        this.style.opacity = '0.7';
                        this.style.transform = 'scale(0.95)';
                    });
                    
                    element.addEventListener('touchend', function() {
                        this.style.opacity = '1';
                        this.style.transform = 'scale(1)';
                    });
                    
                    element.addEventListener('touchcancel', function() {
                        this.style.opacity = '1';
                        this.style.transform = 'scale(1)';
                    });
                }
            });

            loadOrderInfo();
            simulateLocationTracking();
        });

        // åŠ è½½è®¢å•ä¿¡æ¯
        function loadOrderInfo() {
            const order = JSON.parse(localStorage.getItem('currentOrder') || '{}');
            if (order.location) {
                document.getElementById('target-location').textContent = order.location;
            }
        }

        // æ¨¡æ‹Ÿä½ç½®è·Ÿè¸ª
        function simulateLocationTracking() {
            let distance = 50;
            const interval = setInterval(() => {
                distance -= Math.random() * 8 + 2;
                if (distance <= 5) {
                    distance = 0;
                    document.getElementById('distance').textContent = '0';
                    document.getElementById('location-status').textContent = 'å·²åˆ°è¾¾';
                    document.getElementById('location-status').className = 'text-green-500 text-sm font-medium';
                    document.getElementById('confirm-location-btn').disabled = false;
                    document.getElementById('confirm-location-btn').textContent = 'å·²åˆ°è¾¾ - ç‚¹å‡»ç¡®è®¤';
                    document.getElementById('confirm-location-btn').classList.remove('bg-primary');
                    document.getElementById('confirm-location-btn').classList.add('bg-green-500');
                    clearInterval(interval);
                } else {
                    document.getElementById('distance').textContent = Math.round(distance);
                }
            }, 2000);
        }

        // ç¡®è®¤ä½ç½®
        function confirmLocation() {
            document.getElementById('location-status').textContent = 'å·²ç¡®è®¤';
            document.getElementById('location-status').className = 'text-green-500 text-sm font-medium';
            
            // æ›´æ–°çŠ¶æ€
            updateStatus('ğŸ¯', 'ä½ç½®ç¡®è®¤æˆåŠŸ', 'è¯·å¬å”¤æ— äººæœºå¼€å§‹æ‹æ‘„');
            
            // æ˜¾ç¤ºæ§åˆ¶é¢æ¿
            document.getElementById('location-section').classList.add('hidden');
            document.getElementById('control-section').classList.remove('hidden');
            
            currentStep = 'control';

            // å°ç¨‹åºåˆ†æä¸ŠæŠ¥
            if (typeof wx !== 'undefined') {
                wx.reportAnalytics('location_confirmed', {
                    timestamp: Date.now()
                });
            }
        }

        // å¬å”¤æ— äººæœº
        function summonDrone() {
            updateStatus('ğŸš', 'æ— äººæœºæ­£åœ¨é£æ¥', 'è¯·ç¨ç­‰ï¼Œæ— äººæœºå°†åœ¨30ç§’å†…åˆ°è¾¾');
            
            document.getElementById('summon-btn').disabled = true;
            document.getElementById('summon-btn').innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i> æ— äººæœºé£è¡Œä¸­...';
            document.getElementById('summon-btn').classList.add('opacity-60');
            
            // å°ç¨‹åºæŒ¯åŠ¨åé¦ˆ
            if (typeof wx !== 'undefined') {
                wx.vibrateShort({
                    type: 'medium'
                });
            }
            
            // å¼€å§‹å€’è®¡æ—¶
            startCountdown(30, () => {
                droneArrived();
            });
        }

        // å¼€å§‹å€’è®¡æ—¶
        function startCountdown(seconds, callback) {
            const countdownEl = document.getElementById('countdown-display');
            countdownEl.classList.remove('hidden');
            
            let remaining = seconds;
            countdownEl.textContent = remaining;
            
            countdownTimer = setInterval(() => {
                remaining--;
                countdownEl.textContent = remaining;
                
                if (remaining <= 0) {
                    clearInterval(countdownTimer);
                    countdownEl.classList.add('hidden');
                    callback();
                }
            }, 1000);
        }

        // æ— äººæœºåˆ°è¾¾
        function droneArrived() {
            updateStatus('ğŸµ', 'æ— äººæœºå·²åˆ°è¾¾', 'æ— äººæœºæ­£åœ¨ç›˜æ—‹å¹¶æ’­æ”¾BGMï¼Œè¯·ä¸¾æ‰‹ç¡®è®¤èº«ä»½');
            
            // æ˜¾ç¤ºæ‘„åƒå¤´é¢„è§ˆ
            document.getElementById('camera-preview').classList.remove('hidden');
            document.getElementById('confirm-identity-btn').classList.remove('hidden');
            
            // æ’­æ”¾BGMæç¤º
            showVoiceTip('ğŸµ è¯·é¢å‘æ— äººæœºï¼Œä¸¾æ‰‹ç¤ºæ„');

            // å°ç¨‹åºæŒ¯åŠ¨å’ŒéŸ³æ•ˆ
            if (typeof wx !== 'undefined') {
                wx.vibrateShort({
                    type: 'heavy'
                });
            }
        }

        // ç¡®è®¤èº«ä»½
        function confirmIdentity() {
            updateStatus('ğŸ“¸', 'èº«ä»½è¯†åˆ«ä¸­', 'æ­£åœ¨è¿›è¡Œäººè„¸è¯†åˆ«ç¡®è®¤');
            
            document.getElementById('confirm-identity-btn').disabled = true;
            document.getElementById('confirm-identity-btn').classList.add('opacity-60');
            
            // æ¨¡æ‹Ÿè¯†åˆ«è¿‡ç¨‹
            setTimeout(() => {
                updateStatus('âœ…', 'èº«ä»½ç¡®è®¤æˆåŠŸ', 'è¯·å‡†å¤‡å¼€å§‹æ‹æ‘„');
                document.getElementById('start-shooting-btn').classList.remove('hidden');
                showVoiceTip('âœ… èº«ä»½ç¡®è®¤æˆåŠŸï¼Œç‚¹å‡»å¼€å§‹æ‹æ‘„');
            }, 3000);
        }

        // å¼€å§‹æ‹æ‘„
        function startShooting() {
            updateStatus('ğŸ¬', 'æ‹æ‘„è¿›è¡Œä¸­', 'è¯·é…åˆæ— äººæœºæŒ‡ç¤ºï¼Œä¿æŒæœ€ä½³çŠ¶æ€');
            
            document.getElementById('control-section').classList.add('hidden');
            document.getElementById('shooting-progress').classList.remove('hidden');
            
            currentStep = 'shooting';
            
            // å¼€å§‹æ‹æ‘„è¿›åº¦
            startShootingProgress();

            // å°ç¨‹åºåˆ†æä¸ŠæŠ¥
            if (typeof wx !== 'undefined') {
                wx.reportAnalytics('shooting_started', {
                    timestamp: Date.now()
                });
            }
        }

        // æ‹æ‘„è¿›åº¦æ§åˆ¶
        function startShootingProgress() {
            const voiceTips = [
                'è¯·ä¿æŒå¾®ç¬‘ï¼Œçœ‹å‘é•œå¤´',
                'è¯·ç¨å¾®å‘å·¦è½¬èº«',
                'å¾ˆå¥½ï¼Œä¿æŒè¿™ä¸ªå§¿åŠ¿',
                'è¯·ä¸¾èµ·å³æ‰‹æŒ¥æŒ¥æ‰‹',
                'å®Œç¾ï¼è¯·ä¿æŒè‡ªç„¶çŠ¶æ€',
                'æ‹æ‘„å³å°†å®Œæˆ...'
            ];
            
            let tipIndex = 0;
            let photoCount = 3;
            currentProgress = 0;
            
            progressTimer = setInterval(() => {
                currentProgress += Math.random() * 12 + 3;
                
                if (currentProgress >= 100) {
                    currentProgress = 100;
                    clearInterval(progressTimer);
                    completeShooting();
                }
                
                // æ›´æ–°è¿›åº¦æ¡
                document.getElementById('progress-fill').style.width = currentProgress + '%';
                document.getElementById('progress-text').textContent = `æ‹æ‘„è¿›åº¦: ${Math.round(currentProgress)}%`;
                
                // æ›´æ–°ç…§ç‰‡æ•°é‡
                if (Math.round(currentProgress) % 20 === 0 && photoCount < 15) {
                    photoCount++;
                    document.getElementById('photo-count').textContent = photoCount;
                }
                
                // æ˜¾ç¤ºè¯­éŸ³æç¤º
                if (tipIndex < voiceTips.length && currentProgress > (tipIndex + 1) * 16.67) {
                    showVoiceTip('ğŸ”Š ' + voiceTips[tipIndex]);
                    tipIndex++;
                }
            }, 2000);
        }

        // å®Œæˆæ‹æ‘„
        function completeShooting() {
            updateStatus('ğŸ‰', 'æ‹æ‘„å®Œæˆ', 'æ— äººæœºæ­£åœ¨è¿”èˆªï¼Œæˆç‰‡å°†åœ¨24å°æ—¶å†…åˆ¶ä½œå®Œæˆ');
            
            document.getElementById('shooting-progress').classList.add('hidden');
            document.getElementById('completion-section').classList.remove('hidden');
            
            showVoiceTip('ğŸ‰ æ‹æ‘„å®Œæˆï¼æ— äººæœºæ­£åœ¨è¿”èˆª');
            
            // å°ç¨‹åºåº†ç¥åé¦ˆ
            if (typeof wx !== 'undefined') {
                wx.vibrateShort({
                    type: 'heavy'
                });
                wx.showToast({
                    title: 'æ‹æ‘„å®Œæˆï¼',
                    icon: 'success',
                    duration: 2000
                });
            }
            
            // æ¨¡æ‹Ÿæ— äººæœºè¿”èˆª
            setTimeout(() => {
                hideVoiceTip();
            }, 5000);
            
            currentStep = 'completed';
        }

        // æ˜¾ç¤ºè¯­éŸ³æç¤º
        function showVoiceTip(text) {
            document.getElementById('voice-tip-text').textContent = text;
            document.getElementById('voice-tips').classList.remove('hidden');
            
            // è‡ªåŠ¨éšè—æç¤º
            setTimeout(() => {
                hideVoiceTip();
            }, 4000);
        }

        // éšè—è¯­éŸ³æç¤º
        function hideVoiceTip() {
            document.getElementById('voice-tips').classList.add('hidden');
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(icon, title, desc) {
            document.getElementById('status-icon').textContent = icon;
            document.getElementById('status-title').textContent = title;
            document.getElementById('status-desc').textContent = desc;
        }

        // é¡µé¢ç¦»å¼€æ—¶æ¸…ç†å®šæ—¶å™¨
        window.addEventListener('beforeunload', function() {
            if (countdownTimer) clearInterval(countdownTimer);
            if (progressTimer) clearInterval(progressTimer);
        });
    </script>
</body>
</html>
